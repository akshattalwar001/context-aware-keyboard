<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WordFlow -- AI Keyboard BETA v2.1</title>
  <style>
    body {
      background-color: #000080;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20'%3E%3Crect width='10' height='10' fill='%23000090'/%3E%3Crect x='10' y='10' width='10' height='10' fill='%23000090'/%3E%3C/svg%3E");
      color: #ffff00;
      font-family: "Comic Sans MS", "Comic Sans", cursive;
      margin: 0;
      padding: 10px;
      text-align: center;
    }

    marquee {
      background: #ff0000;
      color: #ffffff;
      font-size: 14px;
      font-weight: bold;
      padding: 4px;
      border: 3px solid yellow;
    }

    h1 {
      font-size: 42px;
      color: #00ffff;
      text-shadow: 3px 3px #ff00ff, 6px 6px #ff0000;
      font-family: "Impact", "Arial Black", sans-serif;
      letter-spacing: 4px;
      margin: 10px 0 0 0;
    }

    h2 {
      font-size: 13px;
      color: #ff00ff;
      font-family: "Comic Sans MS", cursive;
      margin: 2px 0 10px 0;
      font-weight: normal;
    }

    .blink {
      animation: blinker 0.7s step-start infinite;
      color: #ff0000;
      font-weight: bold;
    }
    @keyframes blinker { 50% { opacity: 0; } }

    .main-table {
      width: 640px;
      margin: 0 auto;
      background: #c0c0c0;
      border: 4px outset #ffffff;
      padding: 0;
      color: #000000;
    }

    .title-bar {
      background: linear-gradient(to right, #000080, #1084d0);
      color: white;
      font-family: "Arial", sans-serif;
      font-size: 12px;
      font-weight: bold;
      padding: 3px 6px;
      text-align: left;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .title-bar-buttons {
      display: flex;
      gap: 2px;
    }

    .title-bar-buttons span {
      background: #c0c0c0;
      color: #000;
      border: 2px outset #ffffff;
      font-size: 10px;
      width: 16px;
      height: 14px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-family: Arial, sans-serif;
    }

    .window-content {
      padding: 12px;
    }

    .pred-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 4px;
      margin-bottom: 8px;
    }

    .pred-table td {
      width: 33%;
    }

    .pred-btn {
      width: 100%;
      padding: 6px 4px;
      font-family: "Arial", sans-serif;
      font-size: 12px;
      cursor: pointer;
      border: 2px outset #ffffff;
      background: #c0c0c0;
      color: #000000;
      text-align: center;
    }

    .pred-btn:active {
      border-style: inset;
    }

    .pred-btn.best {
      background: #000080;
      color: #ffffff;
      font-weight: bold;
      border: 2px outset #8888ff;
    }

    .pred-btn.best:active {
      border-style: inset;
    }

    .pred-label {
      display: block;
      font-size: 9px;
      color: #888;
      font-family: Arial;
    }

    .pred-btn.best .pred-label {
      color: #aaaaff;
    }

    .pred-word {
      display: block;
      min-height: 1.1em;
      font-size: 13px;
      font-weight: bold;
    }

    .textbox-label {
      text-align: left;
      font-family: Arial;
      font-size: 12px;
      font-weight: bold;
      color: #000080;
      margin-bottom: 2px;
    }

    textarea {
      width: 100%;
      height: 120px;
      font-family: "Courier New", Courier, monospace;
      font-size: 12px;
      border: 2px inset #888888;
      background: #ffffff;
      color: #000000;
      resize: vertical;
      padding: 4px;
      box-sizing: border-box;
    }

    .statusbar {
      background: #c0c0c0;
      border: 1px inset #888888;
      font-family: Arial;
      font-size: 11px;
      color: #000000;
      display: flex;
      justify-content: space-between;
      padding: 2px 6px;
      margin-top: 6px;
    }

    .statusbar-panel {
      border: 1px inset #888;
      padding: 0 6px;
    }

    .clear-btn {
      font-family: Arial;
      font-size: 11px;
      padding: 2px 10px;
      border: 2px outset #ffffff;
      background: #c0c0c0;
      cursor: pointer;
      color: #000;
    }

    .clear-btn:active {
      border-style: inset;
    }

    .hint-text {
      font-family: Arial;
      font-size: 10px;
      color: #444444;
      margin-top: 4px;
      text-align: left;
    }

    /* OUTER PAGE stuff */
    .page-wrapper {
      max-width: 700px;
      margin: 0 auto;
    }

    .under-construction {
      margin: 8px auto;
      font-size: 11px;
      color: #ffff00;
      font-family: Arial;
    }

    .star-divider {
      color: #ffff00;
      font-size: 18px;
      letter-spacing: 6px;
      margin: 6px 0;
    }

    .side-gifs {
      display: flex;
      justify-content: center;
      gap: 20px;
      align-items: center;
      margin: 6px 0;
    }

    /* Fake spinning star GIF using CSS */
    .spinner {
      width: 32px;
      height: 32px;
      background: radial-gradient(circle, #ffff00 30%, transparent 70%),
                  conic-gradient(#ff0000, #ffff00, #00ff00, #00ffff, #ff00ff, #ff0000);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      border: 2px solid #ffffff;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .explosion {
      width: 30px;
      height: 30px;
      font-size: 26px;
      line-height: 30px;
      animation: explode 0.4s ease-in-out infinite alternate;
    }
    @keyframes explode {
      from { transform: scale(1); }
      to { transform: scale(1.3) rotate(20deg); }
    }

    .hit-counter {
      background: #000000;
      color: #00ff00;
      font-family: "Courier New", monospace;
      font-size: 13px;
      display: inline-block;
      padding: 2px 8px;
      border: 2px inset #00ff00;
      letter-spacing: 3px;
      margin-top: 4px;
    }

    .footer-text {
      color: #aaaaff;
      font-size: 10px;
      font-family: Arial;
      margin-top: 8px;
    }

    .email-link {
      color: #ffff00;
    }

    .wordflow-logo-badge {
      background: #ff6600;
      color: #ffffff;
      font-family: Impact, sans-serif;
      font-size: 10px;
      padding: 1px 5px;
      border: 1px solid #ffffff;
      letter-spacing: 1px;
      display: inline-block;
      vertical-align: middle;
      margin-left: 4px;
    }

    .ie-badge {
      font-size: 9px;
      color: #ffff88;
      font-family: Arial;
      margin-top: 3px;
    }
  </style>
</head>
<body>
  <div class="page-wrapper">

    <!-- Main Window -->
    <table class="main-table" cellpadding="0" cellspacing="0">
      <tr>
        <td>
          <div class="title-bar">
            <span>üìù WordFlow AI Keyboard v2.1 BETA</span>
            <div class="title-bar-buttons">
              <span>_</span>
              <span>‚ñ°</span>
              <span>‚úï</span>
            </div>
          </div>
          <div class="window-content">

            <!-- Predictions -->
            <table class="pred-table">
              <tr>
                <td>
                  <button class="pred-btn left" onclick="appendWord(0)">
                    <span class="pred-label">suggestion</span>
                    <span class="pred-word" id="pred-0">---</span>
                  </button>
                </td>
                <td>
                  <button class="pred-btn best" onclick="appendWord(1)">
                    <span class="pred-label">BEST MATCH</span>
                    <span class="pred-word" id="pred-1">---</span>
                  </button>
                </td>
                <td>
                  <button class="pred-btn right" onclick="appendWord(2)">
                    <span class="pred-label">suggestion</span>
                    <span class="pred-word" id="pred-2">---</span>
                  </button>
                </td>
              </tr>
            </table>

            <!-- Textarea -->
            <div class="textbox-label">Type your text below:</div>
            <textarea
              id="input"
              placeholder="Start typing here... (works best in IE 6)"
              autofocus
              spellcheck="false"
            ></textarea>

            <!-- Status bar -->
            <div class="statusbar">
              <span class="statusbar-panel">
                <span id="dot-emoji" style="font-size:10px;">üü¢</span>
                <span id="status-text" style="font-size:11px;"> ready</span>
              </span>
              <span class="statusbar-panel" id="word-count">0 words</span>
              <button class="clear-btn" onclick="clearAll()">Clear</button>
            </div>



          </div>
        </td>
      </tr>
    </table>



  </div>

  <script>
    const textarea = document.getElementById('input');
    const statusText = document.getElementById('status-text');
    const wordCount = document.getElementById('word-count');
    const dotEmoji = document.getElementById('dot-emoji');

    let debounceTimer = null;

textarea.addEventListener('input', () => {
      const text = textarea.value;
      const words = text.trim().split(/\s+/).filter(Boolean);
      wordCount.textContent = `${words.length} word${words.length !== 1 ? 's' : ''}`;

      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => {
        if (text.trim().length > 0) fetchPredictions(text);
        else resetPredictions();
      }, 250);
    });

    textarea.addEventListener('keydown', (e) => {
      if (e.key === 'Tab') {
        e.preventDefault();
        appendWord(1);
      }
    });

    async function fetchPredictions(text) {
      setLoading(true);
      try {
        const res = await fetch('/predict', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text })
        });
        const data = await res.json();
        updateUI(data.predictions);
      } catch (err) {
        statusText.textContent = ' ERROR!! plz refresh';
        dotEmoji.textContent = 'üî¥';
      } finally {
        setLoading(false);
      }
    }

    function updateUI(predictions) {
      [0, 1, 2].forEach(i => {
        const el = document.getElementById(`pred-${i}`);
        el.textContent = predictions[i] || '---';
      });
      statusText.textContent = ' predicted!!';
      dotEmoji.textContent = 'üü¢';
    }

    function appendWord(btnIndex) {
      const word = document.getElementById(`pred-${btnIndex}`).textContent;
      if (!word || word === '---') return;

      const val = textarea.value;
      const needsSpace = val.length > 0 && !val.endsWith(' ');
      textarea.value = val + (needsSpace ? ' ' : '') + word + ' ';
      textarea.dispatchEvent(new Event('input'));
      textarea.focus();
      textarea.selectionStart = textarea.selectionEnd = textarea.value.length;
    }

    function resetPredictions() {
      ['pred-0', 'pred-1', 'pred-2'].forEach(id => {
        document.getElementById(id).textContent = '---';
      });
      statusText.textContent = ' ready';
      dotEmoji.textContent = 'üü¢';
      wordCount.textContent = '0 words';
    }

    function clearAll() {
      textarea.value = '';
      resetPredictions();
      textarea.focus();
    }

    function setLoading(isLoading) {
      dotEmoji.textContent = isLoading ? 'üü°' : 'üü¢';
      statusText.textContent = isLoading ? ' thinking...' : ' predicted!!';
    }
  </script>
</body>
</html>